
manifest {
  name = 'lifebit-ai/gwas'
  author = ''
  homePage = 'https://github.com/lifebit-ai/gwas'
  description = ''
  mainScript = 'main.nf'
  nextflowVersion = '>=19.10.0'
  version = ''
}

docker.enabled = true

params {
  genotype_files_list = null
  genotype_format = "vcf"
  vcfs_list = false
  input_folder_location = null
  file_pattern = null
  file_suffix = "vcf.gz"
  index_suffix = "vcf.gz.csi"
  number_of_files_to_process = -1

  grm_plink_input = false
  pheno_data = false
  covariate_cols = false

  // GWAS methods
  saige = true
  bolt_lmm = false
  regenie = false


  // BOLT-LMM

  ld_scores = "s3://gwas-reference-files/bolt-lmm/LDSCORE.1000G_EUR.tab.gz"
  bolt_lmm_quant_covariates = null
  bolt_lmm_categ_covariates = null

  // REGENIE

  regenie_min_imputation_score = 0.00
  regenie_min_mac = 5

  q_filter = '0.005:minor'
  maf_filter = 0.05
  miss_test_p_threshold = '1e-5'
  variant_missingness = '0.01'
  hwe_threshold = '1e-5'
  hwe_test = 'midp'
  high_LD_long_range_regions = "$baseDir/assets/data/high-LD-regions-hg38-GRCh38.txt"

  ld_window_size = 50
  ld_step_size = 10
  ld_r2_threshold = 0.1

  run_pca = true
  number_pcs = 10

  plink_memory = 16000

  trait_type = 'binary'
  saige_step1_extra_flags = "--LOCO=FALSE"
  outdir = 'results'
  gwas_cat = 's3://lifebit-featured-datasets/projects/gel/gel-gwas/gwascat.csv'
  phenotype_colname = "PHE"
  output_tag = null
  p_significance_threshold = 0.01
  top_n_sites = 200
  max_top_n_sites = 1000
  saige_filename_pattern = '.SAIGE.gwas.txt'
  config = 'conf/standard.config'


  // process resources defaults
    cpus = 1
    memory = 2.GB
    disk = '30.GB'
    
    // max resources limits defaults
    max_cpus = 32
    max_memory = 240.GB
    max_time = 8.h
    
  // execution related defaults
  echo = false
  errorStrategy = 'finish'
  maxRetries = 1
  maxForks = 200
  queueSize = 200
  executor = false
}

// Profiles

profiles {
  standard {includeConfig params.config }
  base {includeConfig 'conf/base.config'}
  test_binary { includeConfig 'conf/test_binary.config' }
  test_binary_prune_pca { includeConfig 'conf/test_binary_prune_pca.config' }
  test_binary_prune_no_pca { includeConfig 'conf/test_binary_prune_no_pca.config' }
  test_binary_with_input_folder { includeConfig 'conf/test_binary_with_input_folder.config' }
  test_binary_bgen { includeConfig 'conf/test_binary_bgen.config' }
  test_qt { includeConfig 'conf/test_qt.config' }
  test_binary_bolt_lmm { includeConfig 'conf/test_binary_bolt_lmm.config'}
}

// Process scope

process {

    echo = params.echo
    cpus = params.cpus
    memory = params.memory
    maxRetries = params.maxRetries
    maxForks = params.maxForks
    errorStrategy = params.errorStrategy

    container = 'quay.io/lifebitai/gwas:1.2dev'

  withLabel: saige {
    container = 'quay.io/lifebitai/saige:0.39'
  }
  withLabel: bolt_lmm {
    container = 'quay.io/lifebitai/bolt-lmm:2.3.6'
  }

  withName: create_report {
     cpus = 2
  }
}